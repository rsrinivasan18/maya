# MAYA Dev Log - 2026-02-28
## Session 4 - Week 3: Ollama LLM Integration

### Goals
- Replace rule-based `help_response` node with real Ollama LLM call
- MAYA becomes actually intelligent - answers STEM questions in Hinglish/English

### What We Built

#### 1. Ollama Integration (`src/maya/graph/hello_world_graph.py`)
- Installed `ollama==0.6.1` Python client
- Replaced `help_response` node body with `ollama.chat(model="llama3.2:3b", messages=...)`
- Passes full `message_history` to Ollama → context-aware multi-turn conversation
- Model: `llama3.2:3b` (Q4_K_M, ~2GB, runs fully offline on CPU)

#### 2. Bilingual System Prompt
- `_MAYA_BASE_PROMPT`: MAYA's core personality (warm, STEM, 10-year-old appropriate)
- `_LANGUAGE_INSTRUCTIONS`: Per-language reminder injected at call time
  - English → "respond in English only"
  - Hinglish → "respond in Hinglish naturally"
  - Hindi → "respond in Roman-script Hindi"
- `_build_system_prompt(language)` combines both per turn
- Rationale: llama3.2:3b is a 3B model - it needs explicit per-turn language reminders

#### 3. Edge Case Fix
- Tests invoke graph with empty `message_history`
- Added guard: if history is empty or last msg is not user → append `user_input` explicitly
- Ensures Ollama always has a user message to respond to

### Bugs Fixed
- `help_response` test failure: Ollama returned empty when `message_history=[]`
  Fix: Add `user_input` as fallback if message_history has no user message

### Test Results
- 30/30 tests passing (pytest)
- Ollama responses verified for English and Hinglish inputs

### Graph Structure
**UNCHANGED** - same nodes, same edges, same conditional routing.
Only `help_response` node internals changed. This is exactly the architecture principle.

### Python Environment
- Venv rebuilt with Python 3.13.2 (was 3.11) - all packages on cp313 wheels
- VSCode interpreter: set to `.venv\Scripts\python.exe` (Ctrl+Shift+P → Select Interpreter)

### Sample Outputs
**English** ("What is gravity?"):
> Gravity is like a magic string that pulls everything towards each other!
> Imagine you're playing cricket - when you throw the ball, it comes back down
> because of gravity's pull. Does that make sense?

**Hinglish** ("Kya hai photosynthesis?"):
> Srinika, photosynthesis yeh hai ki plants apni khadya banaate hain,
> khaad aur paani ke saath oxygen bhi utpann karti hain.
> Kya tumhara koi sawaal hai?

### Next Session (Week 3 continued or Week 4)
Options:
1. Add a `math_tutor` agent node - route math questions to a dedicated solver
2. Add SQLite memory - MAYA remembers daughter's name, past topics
3. Add LangSmith observability - trace every Ollama call
